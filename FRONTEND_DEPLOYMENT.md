# Frontend Deployment Guide

> **Part of**: [PerfBurger AI Chatbot](./README.md) - Frontend deployment instructions  
> **Current Status**: ✅ Deployed at https://delightful-ground-0a878f803.azurestaticapps.net

## Azure Static Web Apps Deployment

### Prerequisites
1. Azure account with access to create Azure Static Web Apps
2. GitHub repository with the frontend code
3. Backend API deployed and running (current: https://perfburger-chatbot-a6eph3fsavbwc5bm.westeurope-01.azurewebsites.net)

### Steps to Deploy

#### 1. Create Azure Static Web App
1. Go to Azure Portal
2. Create a new resource → Static Web Apps
3. Configure:
   - **Name**: `perfburger-frontend` (or your preferred name)
   - **Subscription**: Choose your subscription
   - **Resource Group**: Use existing or create new
   - **Source**: GitHub
   - **Organization**: Your GitHub username
   - **Repository**: `ai-chatbot-perf-burger`
   - **Branch**: `main`
   - **Build Presets**: React
   - **App location**: `/frontend`
   - **Api location**: `` (leave empty, we use separate backend)
   - **Output location**: `dist`

#### 2. Configure GitHub Secrets
The Azure portal will automatically create a GitHub secret called:
`AZURE_STATIC_WEB_APPS_API_TOKEN_<RANDOM_ID>`

**Note**: The actual secret name will contain a unique identifier generated by Azure.

#### 3. Update Workflow (if needed)
The workflow file is automatically created at:
`.github/workflows/azure-static-web-apps-<random-id>.yml`

**Current workflow file**: `.github/workflows/azure-static-web-apps-delightful-ground-0a878f803.yml`

#### 4. Environment Configuration
The frontend automatically detects the environment and configures the backend URL:
- **Development**: `http://localhost:5000` (backend)
- **Production**: `https://perfburger-chatbot-a6eph3fsavbwc5bm.westeurope-01.azurewebsites.net` (backend)

**Environment Detection Logic**: 
- Localhost domains → Development mode
- `.azurestaticapps.net` domains → Production mode
- See `frontend/src/services/api.ts` for implementation details

### Accessing the Deployed Frontend
After deployment, your frontend will be available at:
`https://<app-name>.<random-id>.azurestaticapps.net`

**Current deployment**: `https://delightful-ground-0a878f803.azurestaticapps.net`

### Custom Domain (Optional)
You can configure a custom domain in the Azure Static Web Apps settings.

### CORS Configuration
The backend is already configured to allow requests from:
- `*.azurestaticapps.net` domains (wildcard)
- `https://delightful-ground-0a878f803.azurestaticapps.net` (current deployment)
- `https://delightful-ground-0a878f803.1.azurestaticapps.net` (staging slots)
- `https://delightful-ground-0a878f803.2.azurestaticapps.net` (additional slots)
- Development localhost URLs (`http://localhost:3000`, `http://localhost:5173`, `http://localhost:4173`)

**Backend CORS configuration**: See `backend/app/__init__.py` lines 35-50

### Troubleshooting

#### Build Issues
1. **Build fails**: Check the GitHub Actions logs in the Actions tab
2. **Node.js version**: Ensure the workflow uses Node.js 20 (current setup)
3. **Dependencies**: Verify `package.json` and `package-lock.json` are committed
4. **Build command**: Default is `npm run build` with output directory `dist`

#### API Connection Issues
1. **API calls fail**: Verify backend CORS configuration includes your domain
2. **CORS errors**: Check that your Static Web App URL is in the backend's allowed origins
3. **Environment detection**: Frontend automatically detects dev vs prod based on hostname
4. **Backend health**: Test backend health endpoint first: `https://perfburger-chatbot-a6eph3fsavbwc5bm.westeurope-01.azurewebsites.net/health`

#### Routing Issues
1. **Routes not working**: Check `staticwebapp.config.json` configuration in `/frontend/public/`
2. **SPA routing**: Ensure the config has proper fallback to `index.html`
3. **404 errors**: Verify the navigation fallback configuration

#### Configuration Files
- **Static Web App config**: `frontend/public/staticwebapp.config.json`
- **GitHub workflow**: `.github/workflows/azure-static-web-apps-delightful-ground-0a878f803.yml`
- **Backend CORS**: `backend/app/__init__.py`

#### Useful Commands
```bash
# Test frontend locally
cd frontend
npm install
npm run dev

# Build for production
npm run build

# Preview production build
npm run preview
```
